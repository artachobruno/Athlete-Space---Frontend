import{r as c}from"./core-DSP-N1cm.js";import{i as l}from"./index-wAqt7xCg.js";const a=c("Preferences"),n="auth_access_token",r="auth_token_expiry";async function m(e,t){if(l()){await a.set({key:n,value:e});const o=Date.now()+t*1e3;await a.set({key:r,value:o.toString()}),console.log("[TokenStorage] Token stored securely in Capacitor Preferences")}else{localStorage.setItem(n,e);const o=Date.now()+t*1e3;localStorage.setItem(r,o.toString()),console.log("[TokenStorage] Token stored in localStorage (web fallback)")}}async function i(){let e=null,t=null;if(l()){const o=await a.get({key:n}),s=await a.get({key:r});e=o.value,t=s.value?parseInt(s.value,10):null}else{e=localStorage.getItem(n);const o=localStorage.getItem(r);t=o?parseInt(o,10):null}return e?t&&Date.now()>=t?(console.log("[TokenStorage] Token expired, clearing"),await g(),null):e:null}async function g(){l()?(await a.remove({key:n}),await a.remove({key:r}),console.log("[TokenStorage] Token cleared from Capacitor Preferences")):(localStorage.removeItem(n),localStorage.removeItem(r),console.log("[TokenStorage] Token cleared from localStorage"))}async function T(){return await i()!==null}export{g as clearAccessToken,i as getAccessToken,T as hasValidToken,m as storeAccessToken};
